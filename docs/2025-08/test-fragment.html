<div class="article-layout">
    <div class="main-content">
        <article class="post">
            <header class="post-header">
                <h1 class="post-title">测试文档</h1>
                <div class="post-meta">
                    <div class="post-date">2025/8/26</div>
                    <div class="post-category">2025-08</div>
                </div>
            </header>
            <div class="warning">
                ⚠️ 注意：此内容由 AI 协助生成，准确性未经验证，请谨慎使用
            </div>
            <div class="post-content" id="post-content">
                <h1 id="测试文档">测试文档</h1>
<p>这是一个测试文档，用于验证 Markdown 到 HTML 的转换功能。</p>
<h2 id="功能特性">功能特性</h2>
<ul>
<li>支持标题转换</li>
<li>支持列表</li>
<li>支持代码块</li>
<li>支持表格</li>
<li>支持引用</li>
</ul>
<h2 id="代码示例">代码示例</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> HelloWorld <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;Hello, World!&quot;</span><span class="op">);</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="表格示例">表格示例</h2>
<table>
<thead>
<tr>
<th>功能</th>
<th>状态</th>
</tr>
</thead>
<tbody>
<tr>
<td>标题转换</td>
<td>✅</td>
</tr>
<tr>
<td>列表转换</td>
<td>✅</td>
</tr>
<tr>
<td>代码块</td>
<td>✅</td>
</tr>
<tr>
<td>表格</td>
<td>✅</td>
</tr>
</tbody>
</table>
<blockquote>
<p>这是一个引用块，用于显示重要信息。</p>
</blockquote>
<p>更新时间: 2025年8月15日</p>
<h2 id="mermaid-示例">mermaid 示例</h2>
<p>```mermaid classDiagram direction TB</p>
<pre><code>%% JVM 内存整体结构
class JVM {
    &lt;&lt;Java虚拟机内存模型&gt;&gt;
}

%% 线程私有区
class ThreadPrivateArea {
    &lt;&lt;线程私有内存&gt;&gt;
    +程序计数器(PC Register): 当前指令地址
    +虚拟机栈(VM Stack): 方法调用栈帧
    +本地方法栈(Native Stack): JNI方法调用
}

%% 线程共享区
class ThreadSharedArea {
    &lt;&lt;线程共享内存&gt;&gt;
    +堆(Heap): 对象实例存储
    +方法区(Method Area): 类元数据/静态变量
}

%% 堆内存细分
class Heap {
    +年轻代(Young Generation)
    +老年代(Old Generation)
}

class YoungGeneration {
    +Eden区: 新对象分配
    +Survivor0(S0): MinorGC存活对象
    +Survivor1(S1): MinorGC存活对象
}

class OldGeneration {
    +长期存活对象
}

%% 方法区细分（JDK8+）
class MethodArea {
    +元空间(Metaspace): 类元数据
    +运行时常量池: 字面量/符号引用
}

%% 关系定义
JVM --&gt; ThreadPrivateArea : 包含
JVM --&gt; ThreadSharedArea : 包含
ThreadSharedArea --&gt; Heap : 主存储区
ThreadSharedArea --&gt; MethodArea : 类/常量存储
Heap --&gt; YoungGeneration : 新生代
Heap --&gt; OldGeneration : 老年代
YoungGeneration --&gt; Eden区
YoungGeneration --&gt; Survivor0
YoungGeneration --&gt; Survivor1</code></pre>
<p>```Test content</p>

            </div>
        </article>
    </div>
    <aside class="toc-sidebar" id="toc-sidebar">
        <div class="toc-header">
            <h3>文章目录</h3>
        </div>
        <nav class="toc-nav" id="toc-nav">
            <!-- 目录内容将通过JavaScript自动生成 -->
        </nav>
    </aside>
</div>

<script>
    // Add copy buttons to code blocks
    function addCopyButtons() {
        const sourceCodeBlocks = document.querySelectorAll('.sourceCode');
        sourceCodeBlocks.forEach(function(block) {
            if (block.querySelector('.copy-button')) return;
            const preElement = block.querySelector('pre');
            if (!preElement) return;

            const button = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = '复制';
            button.setAttribute('aria-label', '复制代码');

            button.addEventListener('click', function() {
                const code = preElement.querySelector('code');
                const text = code ? code.innerText : preElement.innerText;

                navigator.clipboard.writeText(text).then(function() {
                    button.textContent = '已复制';
                    button.classList.add('copied');

                    setTimeout(function() {
                        button.textContent = '复制';
                        button.classList.remove('copied');
                    }, 3000);
                }).catch(function(err) {
                    console.error('复制失败: ', err);
                    button.textContent = '失败';
                    setTimeout(function() {
                        button.textContent = '复制';
                    }, 3000);
                });
            });

            block.appendChild(button);
        });

        const allPreBlocks = document.querySelectorAll('pre:not(.mermaid)');
        allPreBlocks.forEach(function(block) {
            if (block.closest('.sourceCode') || block.querySelector('.copy-button')) return;

            const button = document.createElement('button');
            button.className = 'copy-button';
            button.textContent = '复制';
            button.setAttribute('aria-label', '复制代码');

            button.addEventListener('click', function() {
                const code = block.querySelector('code');
                const text = code ? code.innerText : block.innerText;

                navigator.clipboard.writeText(text).then(function() {
                    button.textContent = '已复制';
                    button.classList.add('copied');

                    setTimeout(function() {
                        button.textContent = '复制';
                        button.classList.remove('copied');
                    }, 3000);
                }).catch(function(err) {
                    console.error('复制失败: ', err);
                    button.textContent = '失败';
                    setTimeout(function() {
                        button.textContent = '复制';
                    }, 3000);
                });
            });

            block.appendChild(button);
        });
    }

    // 生成文章目录
    function generateTableOfContents() {
        const postContent = document.getElementById('post-content');
        const tocNav = document.getElementById('toc-nav');
        
        if (!postContent || !tocNav) return;
        
        // 查找所有标题元素
        const headings = postContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
        if (headings.length === 0) {
            // 如果没有标题，隐藏目录
            document.getElementById('toc-sidebar').style.display = 'none';
            return;
        }
        
        // 创建目录结构
        const tocList = document.createElement('ul');
        tocList.className = 'toc-list';
        
        let currentLevel = 1;
        let currentList = tocList;
        let listStack = [tocList];
        
        headings.forEach((heading, index) => {
            // 强制为每个标题设置标准化的ID（始终重写现有ID）
            const normalizedId = 'heading-' + index;
            heading.id = normalizedId;
            
            const level = parseInt(heading.tagName.charAt(1));
            const title = heading.textContent.trim();
            
            // 创建目录项
            const tocItem = document.createElement('li');
            tocItem.className = 'toc-item toc-level-' + level;
            
            const tocLink = document.createElement('a');
            tocLink.href = 'javascript:void(0)'; // 避免触发路由
            tocLink.setAttribute('data-target', heading.id); // 存储目标ID
            tocLink.textContent = title;
            tocLink.className = 'toc-link';
            
            tocItem.appendChild(tocLink);
            
            // 处理层级关系
            if (level > currentLevel) {
                // 创建新的子列表
                const newList = document.createElement('ul');
                newList.className = 'toc-sublist';
                listStack[listStack.length - 1].lastElementChild.appendChild(newList);
                listStack.push(newList);
                currentList = newList;
            } else if (level < currentLevel) {
                // 返回到上一级
                while (listStack.length > level) {
                    listStack.pop();
                }
                currentList = listStack[listStack.length - 1];
            }
            
            currentList.appendChild(tocItem);
            currentLevel = level;
        });
        
        tocNav.appendChild(tocList);
        
        // 高亮当前章节
        highlightCurrentSection();
        
        // 滚动监听
        window.addEventListener('scroll', highlightCurrentSection);
        
        // 为目录链接添加点击事件
        setTimeout(() => {
            const tocLinks = document.querySelectorAll('.toc-link');
            tocLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('data-target');
                    if (targetId) {
                        const targetElement = document.getElementById(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'start',
                                inline: 'nearest'
                            });
                        }
                    }
                });
            });
        }, 200); // 延迟确保目录已生成
    }
    
    // 高亮当前阅读的章节
    function highlightCurrentSection() {
        const headings = document.querySelectorAll('.post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6');
        const tocLinks = document.querySelectorAll('.toc-link');
        
        let currentHeading = null;
        const scrollPosition = window.pageYOffset + 100;
        
        // 找到当前可见的标题
        for (let i = headings.length - 1; i >= 0; i--) {
            if (headings[i].offsetTop <= scrollPosition) {
                currentHeading = headings[i];
                break;
            }
        }
        
        // 清除所有活动状态
        tocLinks.forEach(link => link.classList.remove('active'));
        
        // 高亮当前章节
        if (currentHeading) {
            const activeLink = document.querySelector('.toc-link[href="#' + currentHeading.id + '"]');
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }
    }

    // Initialize copy buttons and TOC after content loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            addCopyButtons();
            setTimeout(generateTableOfContents, 100); // 延迟生成以确保内容已加载
        });
    } else {
        addCopyButtons();
        setTimeout(generateTableOfContents, 100);
    }
</script>